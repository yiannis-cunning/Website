<!DOCTYPE html>
<html>
<head>
<title>server</title>
<style>
html, body {height: 100%;margin: 0;}
.text_box {height:100%;width:100%;padding: 0px; white-space: nowrap; border:0px solid #000000;font:14px Georgia, Serif;background-color:#757575;}
</style>
</head>
<body>
<div class="text_box">
#include&nbsp;&#60;sys/socket.h&#62;<br>#include&nbsp;&#60;stdio.h&#62;<br>#include&nbsp;&#60;unistd.h&#62;<br>#include&nbsp;&#60;fcntl.h&#62;<br>#include&nbsp;&#60;stdint.h&#62;<br>#include&nbsp;&#60;stdio.h&#62;<br>#include&nbsp;&#60;stdlib.h&#62;<br>#include&nbsp;&#60;string.h&#62;<br>#include&nbsp;&#60;netinet/in.h&#62;<br>#include&nbsp;&#60;arpa/inet.h&#62;<br>#include&nbsp;&#60;stdbool.h&#62;<br>#include&nbsp;&#60;errno.h&#62;<br>#include&nbsp;&#60;errno.h&#62;<br>#include&nbsp;&#60;signal.h&#62;<br>#include&nbsp;&#60;stdbool.h&#62;<br>#include&nbsp;&#60;stdio.h&#62;<br>#include&nbsp;&#60;stdlib.h&#62;<br>#include&nbsp;&#60;string.h&#62;<br>#include&nbsp;&#60;sys/socket.h&#62;<br>#include&nbsp;&#60;sys/un.h&#62;<br>#include&nbsp;&#60;unistd.h&#62;<br><br><br>#define&nbsp;max_read&nbsp;4096;<br><br><br>static&nbsp;int&nbsp;fd;<br><br><br>void&nbsp;passert(bool&nbsp;cond,&nbsp;char&nbsp;*str){<br>&nbsp;&nbsp;&nbsp;&nbsp;if(cond&nbsp;==&nbsp;false){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;err&nbsp;=&nbsp;errno;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;perror(str);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(err);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br><br>void&nbsp;close_socket()&nbsp;{<br>&nbsp;&nbsp;if&nbsp;(close(fd))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;passert(false,&nbsp;&#38;#34;Exited&#38;#34;);<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;exit(0);<br>}<br><br>void&nbsp;handle_signal(int&nbsp;signum)&nbsp;{<br>&nbsp;&nbsp;close_socket();<br>}<br><br><br>void&nbsp;register_signal(int&nbsp;signum)&nbsp;{<br>&nbsp;&nbsp;void&nbsp;(*sig_ret)(int)&nbsp;=&nbsp;signal(signum,&nbsp;handle_signal);<br>&nbsp;&nbsp;if&nbsp;(sig_ret&nbsp;==&nbsp;SIG_ERR)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;err&nbsp;=&nbsp;errno;<br>&nbsp;&nbsp;&nbsp;&nbsp;perror(&#38;#34;signal&#38;#34;);<br>&nbsp;&nbsp;&nbsp;&nbsp;exit(err);<br>&nbsp;&nbsp;}<br>}<br><br><br>void&nbsp;parse_text_to_html(char&nbsp;*filename){<br>&nbsp;&nbsp;f&nbsp;=&nbsp;open(filename,&nbsp;O_RDONLY);<br>&nbsp;&nbsp;<br>}<br><br><br><br><br><br><br>int&nbsp;main(){<br><br>&nbsp;&nbsp;&nbsp;&nbsp;register_signal(SIGINT);<br>&nbsp;&nbsp;&nbsp;&nbsp;register_signal(SIGTERM);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;client;<br>&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;sockaddr_in&nbsp;sockaddr&nbsp;=&nbsp;{0};<br>&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;sockaddr&nbsp;addr_client&nbsp;=&nbsp;{0};<br>&nbsp;&nbsp;&nbsp;&nbsp;socklen_t&nbsp;addr_client_len&nbsp;=&nbsp;{0};<br>&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;buffer[4096];<br>&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;n;<br><br><br><br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Make&nbsp;the&nbsp;socket<br>&nbsp;&nbsp;&nbsp;&nbsp;fd&nbsp;=&nbsp;socket(AF_INET,&nbsp;SOCK_STREAM,&nbsp;0);<br>&nbsp;&nbsp;&nbsp;&nbsp;passert(fd&nbsp;!=&nbsp;-1,&nbsp;&#38;#34;Error&nbsp;getting&nbsp;socket!&#38;#34;);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;#####&nbsp;For&nbsp;debugging<br>&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;tr&nbsp;=&nbsp;1;<br>&nbsp;&nbsp;&nbsp;&nbsp;setsockopt(fd,SOL_SOCKET,SO_REUSEADDR,&#38;tr,sizeof(int));<br><br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Bind&nbsp;to&nbsp;the&nbsp;port&nbsp;and&nbsp;ip&nbsp;of&nbsp;computer<br>&nbsp;&nbsp;&nbsp;&nbsp;sockaddr.sin_family&nbsp;=&nbsp;AF_INET;<br>&nbsp;&nbsp;&nbsp;&nbsp;sockaddr.sin_port&nbsp;=&nbsp;htons(80);&nbsp;&nbsp;//443&nbsp;for&nbsp;https<br>&nbsp;&nbsp;&nbsp;&nbsp;inet_aton(&#38;#34;192.168.4.47&#38;#34;,&nbsp;(struct&nbsp;in_addr&nbsp;*)&#38;sockaddr.sin_addr.s_addr);<br>&nbsp;&nbsp;&nbsp;&nbsp;passert(bind(fd,&nbsp;(struct&nbsp;sockaddr*)&#38;sockaddr,&nbsp;sizeof(struct&nbsp;sockaddr_in))&nbsp;!=&nbsp;-1,&nbsp;&#38;#34;Error&nbsp;trying&nbsp;to&nbsp;bind!&#38;#34;);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Set&nbsp;up&nbsp;with&nbsp;kernel<br>&nbsp;&nbsp;&nbsp;&nbsp;passert(listen(fd,&nbsp;0)&nbsp;!=&nbsp;-1,&nbsp;&#38;#34;Error&nbsp;setting&nbsp;up&nbsp;queue&nbsp;in&nbsp;kernel!&#38;#34;);<br><br><br><br><br>&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;home_fd&nbsp;=&nbsp;open(&#38;#34;Home.html&#38;#34;,&nbsp;O_RDONLY);<br>&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;*hdr&nbsp;=&nbsp;&#38;#34;HTTP/1.1&nbsp;200&nbsp;OK\nContent-Type:&nbsp;text/html;&nbsp;charset=utf-8\nConnection:&nbsp;Keep-Alive\n\n&#38;#34;;<br>&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;hdr_len&nbsp;=&nbsp;strlen(hdr);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Accept&nbsp;loop<br>&nbsp;&nbsp;&nbsp;&nbsp;while(1){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client&nbsp;=&nbsp;accept(fd,&nbsp;&#38;addr_client,&nbsp;&#38;addr_client_len);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(client&nbsp;==&nbsp;-1){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&#38;#34;Error&nbsp;accepting&nbsp;client!&#38;#34;);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Read&nbsp;what&nbsp;they&nbsp;have&nbsp;to&nbsp;say<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;=&nbsp;read(client,&nbsp;buffer,&nbsp;4096);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Write&nbsp;the&nbsp;header&nbsp;first<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write(client,&nbsp;hdr,&nbsp;hdr_len);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Write&nbsp;the&nbsp;rest<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lseek(home_fd,&nbsp;0,&nbsp;SEEK_SET);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;=&nbsp;read(home_fd,&nbsp;buffer,&nbsp;4096);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while(n&nbsp;&#62;&nbsp;0){<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write(client,&nbsp;buffer,&nbsp;n);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;=&nbsp;read(home_fd,&nbsp;buffer,&nbsp;4096);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close(client);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br><br><br>&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;*response&nbsp;=&nbsp;&#38;#34;HTTP/1.1&nbsp;200&nbsp;OK\nContent-Type:&nbsp;text/html;&nbsp;charset=utf-8\nConnection:&nbsp;Keep-Alive\n\n&#60;!DOCTYPE&nbsp;html&#62;\n&#60;head&#62;\n&nbsp;&nbsp;&nbsp;&nbsp;Content&nbsp;\n&#60;/head&#62;\n\n&#60;/html&#62;\n&#38;#34;;<br><br>}<br><br>//Transfer-Encoding:&nbsp;chunked
</div>
</body>
</html>